
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A framework for text-based materials modeling">
      
      
      
        <link rel="canonical" href="https://lamalab-org.github.io/mattext/api/">
      
      
        <link rel="prev" href="../benchmarking/">
      
      
      
      <link rel="icon" href="../static/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.46">
    
    
      
        <title>API Reference - mattext</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775m1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25m13.274 9.537zl-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074M4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.5 4.5 0 0 1-.563-1.191 3.84 3.84 0 0 1-.05-2.063 4.65 4.65 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.4 2.4 0 0 1-.507-.441 3.1 3.1 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19.01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.7 3.7 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.76 2.76 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6 6 0 0 0-.26.16 1 1 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661q.154-.1.313-.195l.007-.004c.1-.061.182-.11.258-.161a1 1 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.61.61 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1 1 0 0 0-.34.398M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0M9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006-.004-.009-.006-.006-.008-.001q-.005 0-.009.004"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5m4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5m0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5M2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CMonaco:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Monaco"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="mattext" class="md-header__button md-logo" aria-label="mattext" data-md-component="logo">
      
  <img src="../static/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mattext
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lamalab-org/mattext.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    lamalab-org/mattext
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../getting_started/" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../representations/" class="md-tabs__link">
        
  
    
  
  Representations

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../tokenizers/" class="md-tabs__link">
        
  
    
  
  Tokenizers

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../benchmarking/" class="md-tabs__link">
        
  
    
  
  Modeling & Benchmarking

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="mattext" class="md-nav__button md-logo" aria-label="mattext" data-md-component="logo">
      
  <img src="../static/logo.png" alt="logo">

    </a>
    mattext
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lamalab-org/mattext.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    lamalab-org/mattext
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../representations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Representations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokenizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tokenizers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmarking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modeling & Benchmarking
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#text-representation" class="md-nav__link">
    <span class="md-ellipsis">
      Text representation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Text representation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-class" class="md-nav__link">
    <span class="md-ellipsis">
      Core class
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep" class="md-nav__link">
    <span class="md-ellipsis">
      TextRep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.apply_transformations" class="md-nav__link">
    <span class="md-ellipsis">
      apply_transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.from_input" class="md-nav__link">
    <span class="md-ellipsis">
      from_input
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_all_text_reps" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_text_reps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_atom_sequences_plusplus" class="md-nav__link">
    <span class="md-ellipsis">
      get_atom_sequences_plusplus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_cif_string" class="md-nav__link">
    <span class="md-ellipsis">
      get_cif_string
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_composition" class="md-nav__link">
    <span class="md-ellipsis">
      get_composition
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_coords" class="md-nav__link">
    <span class="md-ellipsis">
      get_coords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_crystal_text_llm" class="md-nav__link">
    <span class="md-ellipsis">
      get_crystal_text_llm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_lattice_parameters" class="md-nav__link">
    <span class="md-ellipsis">
      get_lattice_parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_local_env_rep" class="md-nav__link">
    <span class="md-ellipsis">
      get_local_env_rep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_requested_text_reps" class="md-nav__link">
    <span class="md-ellipsis">
      get_requested_text_reps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_robocrys_rep" class="md-nav__link">
    <span class="md-ellipsis">
      get_robocrys_rep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_slices" class="md-nav__link">
    <span class="md-ellipsis">
      get_slices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_wyckoff_positions" class="md-nav__link">
    <span class="md-ellipsis">
      get_wyckoff_positions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_wycryst" class="md-nav__link">
    <span class="md-ellipsis">
      get_wycryst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.get_zmatrix_rep" class="md-nav__link">
    <span class="md-ellipsis">
      get_zmatrix_rep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.round_numbers_in_string" class="md-nav__link">
    <span class="md-ellipsis">
      round_numbers_in_string
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.TextRep.updated_zmatrix_rep" class="md-nav__link">
    <span class="md-ellipsis">
      updated_zmatrix_rep
    </span>
  </a>
  
    <nav class="md-nav" aria-label="updated_zmatrix_rep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decoding" class="md-nav__link">
    <span class="md-ellipsis">
      Decoding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.decoder" class="md-nav__link">
    <span class="md-ellipsis">
      decoder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.decoder.DecodeTextRep" class="md-nav__link">
    <span class="md-ellipsis">
      DecodeTextRep
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DecodeTextRep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.DecodeTextRep.cif_string_decoder_p1" class="md-nav__link">
    <span class="md-ellipsis">
      cif_string_decoder_p1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.DecodeTextRep.cif_string_decoder_sym" class="md-nav__link">
    <span class="md-ellipsis">
      cif_string_decoder_sym
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.DecodeTextRep.llm_decoder" class="md-nav__link">
    <span class="md-ellipsis">
      llm_decoder
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.DecodeTextRep.wyckoff_decoder" class="md-nav__link">
    <span class="md-ellipsis">
      wyckoff_decoder
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.decoder.MatchRep" class="md-nav__link">
    <span class="md-ellipsis">
      MatchRep
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MatchRep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.MatchRep.cif_string_matcher_p1" class="md-nav__link">
    <span class="md-ellipsis">
      cif_string_matcher_p1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.MatchRep.cif_string_matcher_sym" class="md-nav__link">
    <span class="md-ellipsis">
      cif_string_matcher_sym
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.MatchRep.llm_matcher" class="md-nav__link">
    <span class="md-ellipsis">
      llm_matcher
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.representations.decoder.MatchRep.wyckoff_matcher" class="md-nav__link">
    <span class="md-ellipsis">
      wyckoff_matcher
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Transformations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.representations.transformations" class="md-nav__link">
    <span class="md-ellipsis">
      transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      Tokenizer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      tokenizer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.CifTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      CifTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CifTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.CifTokenizer.token_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      token_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.CompositionTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      CompositionTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CompositionTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.CompositionTokenizer.token_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      token_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.CrysllmTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      CrysllmTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrysllmTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.CrysllmTokenizer.token_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      token_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      NumTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NumTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer.convert_tokens_to_float" class="md-nav__link">
    <span class="md-ellipsis">
      convert_tokens_to_float
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer.convert_tokens_to_string" class="md-nav__link">
    <span class="md-ellipsis">
      convert_tokens_to_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer.num_matcher" class="md-nav__link">
    <span class="md-ellipsis">
      num_matcher
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.NumTokenizer.tokenize" class="md-nav__link">
    <span class="md-ellipsis">
      tokenize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.RobocrysTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      RobocrysTokenizer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.tokenizer.SliceTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      SliceTokenizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SliceTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.SliceTokenizer.convert_tokens_to_string" class="md-nav__link">
    <span class="md-ellipsis">
      convert_tokens_to_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.tokenizer.SliceTokenizer.token_analysis" class="md-nav__link">
    <span class="md-ellipsis">
      token_analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      benchmark
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.finetune" class="md-nav__link">
    <span class="md-ellipsis">
      finetune
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.llama_sft" class="md-nav__link">
    <span class="md-ellipsis">
      llama_sft
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.llama_sft.FinetuneLLamaSFT" class="md-nav__link">
    <span class="md-ellipsis">
      FinetuneLLamaSFT
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FinetuneLLamaSFT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.models.llama_sft.FinetuneLLamaSFT.finetune" class="md-nav__link">
    <span class="md-ellipsis">
      finetune
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.llama" class="md-nav__link">
    <span class="md-ellipsis">
      llama
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.llama.FinetuneLLama" class="md-nav__link">
    <span class="md-ellipsis">
      FinetuneLLama
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FinetuneLLama">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.models.llama.FinetuneLLama.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.models.llama.FinetuneLLama.finetune" class="md-nav__link">
    <span class="md-ellipsis">
      finetune
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.llama.smart_tokenizer_and_embedding_resize" class="md-nav__link">
    <span class="md-ellipsis">
      smart_tokenizer_and_embedding_resize
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.potential" class="md-nav__link">
    <span class="md-ellipsis">
      potential
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.potential.PotentialModel" class="md-nav__link">
    <span class="md-ellipsis">
      PotentialModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PotentialModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.models.potential.PotentialModel.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mattext.models.potential.PotentialModel.finetune" class="md-nav__link">
    <span class="md-ellipsis">
      finetune
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.pretrain" class="md-nav__link">
    <span class="md-ellipsis">
      pretrain
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mattext.models.pretrain.PretrainModel" class="md-nav__link">
    <span class="md-ellipsis">
      PretrainModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PretrainModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mattext.models.pretrain.PretrainModel.pretrain_mlm" class="md-nav__link">
    <span class="md-ellipsis">
      pretrain_mlm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link">🔗</a></h1>
<h2 id="text-representation">Text representation<a class="headerlink" href="#text-representation" title="Permanent link">🔗</a></h2>
<h3 id="core-class">Core class<a class="headerlink" href="#core-class" title="Permanent link">🔗</a></h3>


<div class="doc doc-object doc-class">



<a id="mattext.representations.TextRep"></a>
    <div class="doc doc-contents first">


        <p>Generate text representations of crystal structure for Language modelling.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mattext.representations.TextRep.structure">structure</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pymatgen structure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="mattext.representations.TextRep.from_input ">from_input </span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>a classmethod</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>xtal2txt/core.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TextRep</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate text representations of crystal structure for Language modelling.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        structure : pymatgen structure</span>

<span class="sd">    Methods:</span>
<span class="sd">        from_input : a classmethod</span>
<span class="sd">        get_cif_string(n=3)</span>
<span class="sd">        get_parameters(n=3)</span>
<span class="sd">        get_coords(name, n=3)</span>
<span class="sd">        get_cartesian(n=3)</span>
<span class="sd">        get_fractional(n=3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">backend</span> <span class="o">=</span> <span class="n">InvCryRep</span><span class="p">()</span>
    <span class="n">condenser</span> <span class="o">=</span> <span class="n">StructureCondenser</span><span class="p">()</span>
    <span class="n">describer</span> <span class="o">=</span> <span class="n">StructureDescriber</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">structure</span><span class="p">:</span> <span class="n">Structure</span><span class="p">,</span>
        <span class="n">transformations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span> <span class="o">=</span> <span class="n">transformations</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_transformations</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_input</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Structure</span><span class="p">],</span>
        <span class="n">transformations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TextRep&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate the TextRep class object with the pymatgen structure from a cif file, a cif string, or a pymatgen Structure object.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_data (Union[str,pymatgen.core.structure.Structure]): A cif file of a crystal structure, a cif string,</span>
<span class="sd">                or a pymatgen Structure object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TextRep: A TextRep object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">input_data</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                    <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">),</span> <span class="s2">&quot;cif&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">),</span> <span class="s2">&quot;cif&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">transformations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_transformations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply transformations to the structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
            <span class="n">transform_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">TransformationCallback</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">transform_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_safe_call</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">round_numbers_in_string</span><span class="p">(</span><span class="n">original_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rounds float numbers in the given string to the specified number of decimal places using regex.</span>

<span class="sd">        Args:</span>
<span class="sd">            original_string (str): The input string.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The string with the float numbers rounded to the specified number of decimal places.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\b\d+\.\d+\b&quot;</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">original_string</span><span class="p">)</span>
        <span class="n">rounded_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="p">),</span> <span class="n">decimal_places</span><span class="p">)</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
        <span class="n">new_string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="n">pattern</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">rounded_numbers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">original_string</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_string</span>

    <span class="k">def</span> <span class="nf">get_cif_string</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate CIF as string in multi-line format.</span>

<span class="sd">        All float numbers can be rounded to the specified number (decimal_places).</span>
<span class="sd">        Currently supports two formats. Symmetrized (cif with symmetry operations and the least symmetric basis) ...</span>
<span class="sd">        and P1 (conventional unit cell , with all the atoms listed and only identity as symmetry operation).</span>

<span class="sd">        Args:</span>
<span class="sd">            format (str): The format of the CIF file. Can be &quot;symmetrized&quot; or &quot;p1&quot;.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The CIF string.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;symmetrized&quot;</span><span class="p">:</span>
            <span class="n">symmetry_analyzer</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
            <span class="n">symmetrized_structure</span> <span class="o">=</span> <span class="n">symmetry_analyzer</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span>
            <span class="n">cif_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">CifWriter</span><span class="p">(</span>
                    <span class="n">symmetrized_structure</span><span class="p">,</span>
                    <span class="n">symprec</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                    <span class="n">significant_figures</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">cif_file</span>
            <span class="p">)</span>
            <span class="n">cif</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cif_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_numbers_in_string</span><span class="p">(</span><span class="n">cif</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;p1&quot;</span><span class="p">:</span>
            <span class="n">cif_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;cif&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_numbers_in_string</span><span class="p">(</span><span class="n">cif_string</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_lattice_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return lattice parameters of unit cells in a crystal lattice:</span>
<span class="sd">        the lengths of the cell edges (a, b, and c) in angstrom and the angles between them (alpha, beta, and gamma) in degrees.</span>

<span class="sd">        All float numbers can be rounded to a specific number (decimal_places).</span>

<span class="sd">        Args:</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: The lattice parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of atoms in unit cell for with their positions in Cartesian or fractional coordinates as per choice.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the coordinates. Can be &quot;cartesian&quot; or &quot;fractional&quot;.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: The list of atoms with their positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">))</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">site</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cartesian&quot;</span>
                    <span class="k">else</span> <span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">]</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">elements</span>

    <span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns SLICES representation of the crystal structure.</span>
<span class="sd">        https://www.nature.com/articles/s41467-023-42870-7</span>

<span class="sd">        Args:</span>
<span class="sd">            primitive (bool): Whether to use the primitive structure or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The SLICE representation of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">primitive</span><span class="p">:</span>
            <span class="n">primitive_structure</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span>
            <span class="p">)</span>  <span class="c1"># convert to primitive structure</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">structure2SLICES</span><span class="p">(</span><span class="n">primitive_structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">structure2SLICES</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_composition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;hill&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return composition in hill format.</span>

<span class="sd">        Args:</span>
<span class="sd">            format (str): format in which the composition is required.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The composition in hill format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;hill&quot;</span><span class="p">:</span>
            <span class="n">composition_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">hill_formula</span>
            <span class="n">composition</span> <span class="o">=</span> <span class="n">composition_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">composition</span>

    <span class="k">def</span> <span class="nf">get_local_env_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the local environment representation of the crystal structure.</span>

<span class="sd">        The local environment representation is a string that contains</span>
<span class="sd">        the space group symbol and the local environment of each atom in the unit cell.</span>
<span class="sd">        The local environment of each atom is represented as SMILES string and the</span>
<span class="sd">        Wyckoff symbol of the local environment.</span>

<span class="sd">        Args:</span>
<span class="sd">            local_env_kwargs (dict): Keyword arguments to pass to the LocalEnvAnalyzer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The local environment representation of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">local_env_kwargs</span><span class="p">:</span>
            <span class="n">local_env_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">analyzer</span> <span class="o">=</span> <span class="n">LocalEnvAnalyzer</span><span class="p">(</span><span class="o">**</span><span class="n">local_env_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">structure_to_local_env_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_crystal_text_llm</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">permute_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Code adopted from https://github.com/facebookresearch/crystal-llm/blob/main/llama_finetune.py</span>
<span class="sd">        https://openreview.net/pdf?id=0r5DE2ZSwJ</span>

<span class="sd">        Returns the representation as per the above citation.</span>

<span class="sd">        Args:</span>
<span class="sd">            permute_atoms (bool): Whether to permute the atoms in the unit cell.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The crystal-llm representation of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">atom_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">species</span>
        <span class="n">frac_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span>

        <span class="k">if</span> <span class="n">permute_atoms</span><span class="p">:</span>
            <span class="n">atom_coord_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span><span class="p">))</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">atom_coord_pairs</span><span class="p">)</span>
            <span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">atom_coord_pairs</span><span class="p">)</span>

        <span class="n">crystal_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{0:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">crystal_str</span>

    <span class="k">def</span> <span class="nf">get_robocrys_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        https://github.com/hackingmaterials/robocrystallographer/tree/main</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">condensed_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">condense_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">describer</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">condensed_structure</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_wyckoff_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getting wyckoff positions of the elements in the unit cell as the combination of...</span>
<span class="sd">        number and letter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str:  A multi-line string that contain elements of the unit cell along with their wyckoff position in each line.</span>

<span class="sd">        Hint:</span>
<span class="sd">            At the end of the string, there is an additional newline character.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">spacegroup_analyzer</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">wyckoff_sites</span> <span class="o">=</span> <span class="n">spacegroup_analyzer</span><span class="o">.</span><span class="n">get_symmetry_dataset</span><span class="p">()</span>
        <span class="n">element_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">])):</span>
            <span class="n">sub_data</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">element_symbols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;equivalent_atoms&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_data</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">get_wycryst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtaining the wyckoff representation for crystal structures that include:</span>
<span class="sd">            chemical formula</span>
<span class="sd">            space group number</span>
<span class="sd">            elements of the unit cell with their wyckoff positions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A multi-line string that contains the chemical formula, space group number,</span>
<span class="sd">                and the elements of the unit cell with their wyckoff positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">chemical_formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">formula</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="n">chemical_formula</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_space_group_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wyckoff_positions</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">get_atom_sequences_plusplus</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generating a string with the elements of composition inside the crystal lattice with the option to</span>
<span class="sd">        get the lattice parameters as angles (int) and lengths (float) in a string with a space</span>
<span class="sd">        between them</span>

<span class="sd">        Args:</span>
<span class="sd">            lattice_params (bool): Whether to include lattice parameters or not.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The string representation of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lattice_params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice_parameters</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span>
            <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updated_zmatrix_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmatrix</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the variables in the Z-matrix with their values and return the updated Z-matrix.</span>
<span class="sd">        for eg: z-matrix from pymatgen</span>
<span class="sd">        &#39;N\nN 1 B1\nN 1 B2 2 A2\nN 1 B3 2 A3 3 D3\n</span>
<span class="sd">        B1=3.79</span>
<span class="sd">        B2=6.54</span>
<span class="sd">        ....</span>
<span class="sd">        is replaced to</span>
<span class="sd">        &#39;N\nN 1 3.79\nN 1 6.54 2 90\nN 1 6.54 2 90 3 120\n&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            Zmatrix (bool): zmatrix multi line string as implemented in pymatgen.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The updated Z-matrix representation of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">zmatrix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">main_part</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">variables_part</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Determine the main part and the variables part of the Z-matrix</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">variables_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># Skip empty lines</span>
                    <span class="n">main_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

        <span class="c1"># Extract variables from the variables part</span>
        <span class="n">variable_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">var_line</span> <span class="ow">in</span> <span class="n">variables_part</span><span class="p">:</span>
            <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">var_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
                <span class="n">rounded_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">decimal_places</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rounded_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())))</span>
            <span class="n">variable_dict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rounded_value</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">))</span>
                <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rounded_value</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Replace variables in the main part</span>
        <span class="n">replaced_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">main_part</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># atom = parts[0]</span>
            <span class="n">replaced_line</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variable_dict</span><span class="p">:</span>
                    <span class="n">replaced_line</span> <span class="o">=</span> <span class="n">replaced_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">variable_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="n">replaced_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replaced_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replaced_lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_zmatrix_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the Z-matrix representation of the crystal structure.</span>
<span class="sd">        It provides a description of each atom in terms of its atomic number,</span>
<span class="sd">        bond length, bond angle, and dihedral angle, the so-called internal coordinates.</span>

<span class="sd">        Disclaimer: The Z-matrix is meant for molecules, current implementation converts atoms within unit cell to molecule.</span>
<span class="sd">        Hence the current implentation might overlook bonds acrosse unit cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">species</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">s</span><span class="o">.</span><span class="n">element</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;element&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">species</span>
        <span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">]</span>
        <span class="n">molecule_</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span>
            <span class="n">species</span><span class="p">,</span>
            <span class="n">coords</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">zmatrix</span> <span class="o">=</span> <span class="n">molecule_</span><span class="o">.</span><span class="n">get_zmatrix</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_zmatrix_rep</span><span class="p">(</span><span class="n">zmatrix</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_all_text_reps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all the Text representations of the crystal structure in a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
            <span class="p">),</span>
            <span class="s2">&quot;cif_symmetrized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
            <span class="p">),</span>
            <span class="s2">&quot;cif_bonding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;slices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slices</span><span class="p">),</span>
            <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_composition</span><span class="p">),</span>
            <span class="s2">&quot;crystal_text_llm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_crystal_text_llm</span><span class="p">),</span>
            <span class="s2">&quot;robocrys_rep&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_robocrys_rep</span><span class="p">),</span>
            <span class="s2">&quot;wycoff_rep&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;atom_sequences&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
                <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;atom_sequences_plusplus&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
                <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s2">&quot;zmatrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_zmatrix_rep</span><span class="p">),</span>
            <span class="s2">&quot;local_env&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_env_rep</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_requested_text_reps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">requested_reps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the requested Text representations of the crystal structure in a dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            requested_reps (List[str]): The list of representations to return.</span>
<span class="sd">            decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing the requested text representations of the crystal structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;cif_symmetrized&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span>
                <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;slices&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slices</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;composition&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_composition</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;crystal_text_llm&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_crystal_text_llm</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;robocrys_rep&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_robocrys_rep</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;atom_sequences&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
                <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;atom_sequences_plusplus&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
                <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;zmatrix&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_zmatrix_rep</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;local_env&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_env_rep</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.apply_transformations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_transformations</span><span class="p">()</span></code>

<a href="#mattext.representations.TextRep.apply_transformations" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Apply transformations to the structure.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_transformations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply transformations to the structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">transformation</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations</span><span class="p">:</span>
        <span class="n">transform_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">TransformationCallback</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">transform_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.from_input" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_input</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">transformations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#mattext.representations.TextRep.from_input" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Instantiate the TextRep class object with the pymatgen structure from a cif file, a cif string, or a pymatgen Structure object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_data</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[str, <span title="pymatgen.core.structure.Structure">Structure</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A cif file of a crystal structure, a cif string,
or a pymatgen Structure object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>TextRep</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="xtal2txt.core.TextRep" href="#mattext.representations.TextRep">TextRep</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A TextRep object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_input</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">input_data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="n">Structure</span><span class="p">],</span>
    <span class="n">transformations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TextRep&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instantiate the TextRep class object with the pymatgen structure from a cif file, a cif string, or a pymatgen Structure object.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_data (Union[str,pymatgen.core.structure.Structure]): A cif file of a crystal structure, a cif string,</span>
<span class="sd">            or a pymatgen Structure object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TextRep: A TextRep object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">Structure</span><span class="p">):</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">input_data</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">),</span> <span class="s2">&quot;cif&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_data</span><span class="p">),</span> <span class="s2">&quot;cif&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">transformations</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_all_text_reps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_text_reps</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_all_text_reps" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Returns all the Text representations of the crystal structure in a dictionary.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_text_reps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns all the Text representations of the crystal structure in a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
        <span class="p">),</span>
        <span class="s2">&quot;cif_symmetrized&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
        <span class="p">),</span>
        <span class="s2">&quot;cif_bonding&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;slices&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slices</span><span class="p">),</span>
        <span class="s2">&quot;composition&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_composition</span><span class="p">),</span>
        <span class="s2">&quot;crystal_text_llm&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_crystal_text_llm</span><span class="p">),</span>
        <span class="s2">&quot;robocrys_rep&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_robocrys_rep</span><span class="p">),</span>
        <span class="s2">&quot;wycoff_rep&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;atom_sequences&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
            <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;atom_sequences_plusplus&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
            <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;zmatrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_zmatrix_rep</span><span class="p">),</span>
        <span class="s2">&quot;local_env&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_env_rep</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_atom_sequences_plusplus" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_atom_sequences_plusplus</span><span class="p">(</span><span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_atom_sequences_plusplus" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Generating a string with the elements of composition inside the crystal lattice with the option to
get the lattice parameters as angles (int) and lengths (float) in a string with a space
between them</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_params</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include lattice parameters or not.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string representation of the crystal structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_atom_sequences_plusplus</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generating a string with the elements of composition inside the crystal lattice with the option to</span>
<span class="sd">    get the lattice parameters as angles (int) and lengths (float) in a string with a space</span>
<span class="sd">    between them</span>

<span class="sd">    Args:</span>
<span class="sd">        lattice_params (bool): Whether to include lattice parameters or not.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The string representation of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lattice_params</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice_parameters</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span>
        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_cif_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cif_string</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;symmetrized&#39;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_cif_string" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Generate CIF as string in multi-line format.</p>
<p>All float numbers can be rounded to the specified number (decimal_places).
Currently supports two formats. Symmetrized (cif with symmetry operations and the least symmetric basis) ...
and P1 (conventional unit cell , with all the atoms listed and only identity as symmetry operation).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format of the CIF file. Can be "symmetrized" or "p1".</p>
              </div>
            </td>
            <td>
                  <code>&#39;symmetrized&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The CIF string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_cif_string</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate CIF as string in multi-line format.</span>

<span class="sd">    All float numbers can be rounded to the specified number (decimal_places).</span>
<span class="sd">    Currently supports two formats. Symmetrized (cif with symmetry operations and the least symmetric basis) ...</span>
<span class="sd">    and P1 (conventional unit cell , with all the atoms listed and only identity as symmetry operation).</span>

<span class="sd">    Args:</span>
<span class="sd">        format (str): The format of the CIF file. Can be &quot;symmetrized&quot; or &quot;p1&quot;.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The CIF string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;symmetrized&quot;</span><span class="p">:</span>
        <span class="n">symmetry_analyzer</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">symmetrized_structure</span> <span class="o">=</span> <span class="n">symmetry_analyzer</span><span class="o">.</span><span class="n">get_symmetrized_structure</span><span class="p">()</span>
        <span class="n">cif_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">CifWriter</span><span class="p">(</span>
                <span class="n">symmetrized_structure</span><span class="p">,</span>
                <span class="n">symprec</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="n">significant_figures</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">cif_file</span>
        <span class="p">)</span>
        <span class="n">cif</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cif_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_numbers_in_string</span><span class="p">(</span><span class="n">cif</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;p1&quot;</span><span class="p">:</span>
        <span class="n">cif_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;cif&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_numbers_in_string</span><span class="p">(</span><span class="n">cif_string</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_composition" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_composition</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;hill&#39;</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_composition" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Return composition in hill format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>format in which the composition is required.</p>
              </div>
            </td>
            <td>
                  <code>&#39;hill&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The composition in hill format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_composition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;hill&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return composition in hill format.</span>

<span class="sd">    Args:</span>
<span class="sd">        format (str): format in which the composition is required.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The composition in hill format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;hill&quot;</span><span class="p">:</span>
        <span class="n">composition_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">hill_formula</span>
        <span class="n">composition</span> <span class="o">=</span> <span class="n">composition_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">composition</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_coords" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_coords</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cartesian&#39;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_coords" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Return list of atoms in unit cell for with their positions in Cartesian or fractional coordinates as per choice.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the coordinates. Can be "cartesian" or "fractional".</p>
              </div>
            </td>
            <td>
                  <code>&#39;cartesian&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: The list of atoms with their positions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cartesian&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of atoms in unit cell for with their positions in Cartesian or fractional coordinates as per choice.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the coordinates. Can be &quot;cartesian&quot; or &quot;fractional&quot;.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The list of atoms with their positions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="p">))</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">site</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;cartesian&quot;</span>
                <span class="k">else</span> <span class="n">site</span><span class="o">.</span><span class="n">frac_coords</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimal_places</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">elements</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_crystal_text_llm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_crystal_text_llm</span><span class="p">(</span><span class="n">permute_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_crystal_text_llm" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Code adopted from https://github.com/facebookresearch/crystal-llm/blob/main/llama_finetune.py
https://openreview.net/pdf?id=0r5DE2ZSwJ</p>
<p>Returns the representation as per the above citation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>permute_atoms</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to permute the atoms in the unit cell.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The crystal-llm representation of the crystal structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_crystal_text_llm</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">permute_atoms</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Code adopted from https://github.com/facebookresearch/crystal-llm/blob/main/llama_finetune.py</span>
<span class="sd">    https://openreview.net/pdf?id=0r5DE2ZSwJ</span>

<span class="sd">    Returns the representation as per the above citation.</span>

<span class="sd">    Args:</span>
<span class="sd">        permute_atoms (bool): Whether to permute the atoms in the unit cell.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The crystal-llm representation of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="n">atom_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">species</span>
    <span class="n">frac_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">frac_coords</span>

    <span class="k">if</span> <span class="n">permute_atoms</span><span class="p">:</span>
        <span class="n">atom_coord_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span><span class="p">))</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">atom_coord_pairs</span><span class="p">)</span>
        <span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">atom_coord_pairs</span><span class="p">)</span>

    <span class="n">crystal_str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{0:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">])</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">atom_ids</span><span class="p">,</span> <span class="n">frac_coords</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">crystal_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_lattice_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lattice_parameters</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_lattice_parameters" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Return lattice parameters of unit cells in a crystal lattice:
the lengths of the cell edges (a, b, and c) in angstrom and the angles between them (alpha, beta, and gamma) in degrees.</p>
<p>All float numbers can be rounded to a specific number (decimal_places).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: The lattice parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_lattice_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return lattice parameters of unit cells in a crystal lattice:</span>
<span class="sd">    the lengths of the cell edges (a, b, and c) in angstrom and the angles between them (alpha, beta, and gamma) in degrees.</span>

<span class="sd">    All float numbers can be rounded to a specific number (decimal_places).</span>

<span class="sd">    Args:</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The lattice parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">parameters</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_local_env_rep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_local_env_rep</span><span class="p">(</span><span class="n">local_env_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_local_env_rep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Get the local environment representation of the crystal structure.</p>
<p>The local environment representation is a string that contains
the space group symbol and the local environment of each atom in the unit cell.
The local environment of each atom is represented as SMILES string and the
Wyckoff symbol of the local environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>local_env_kwargs</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments to pass to the LocalEnvAnalyzer.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local environment representation of the crystal structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_local_env_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the local environment representation of the crystal structure.</span>

<span class="sd">    The local environment representation is a string that contains</span>
<span class="sd">    the space group symbol and the local environment of each atom in the unit cell.</span>
<span class="sd">    The local environment of each atom is represented as SMILES string and the</span>
<span class="sd">    Wyckoff symbol of the local environment.</span>

<span class="sd">    Args:</span>
<span class="sd">        local_env_kwargs (dict): Keyword arguments to pass to the LocalEnvAnalyzer.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The local environment representation of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">local_env_kwargs</span><span class="p">:</span>
        <span class="n">local_env_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="n">LocalEnvAnalyzer</span><span class="p">(</span><span class="o">**</span><span class="n">local_env_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analyzer</span><span class="o">.</span><span class="n">structure_to_local_env_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_requested_text_reps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_requested_text_reps</span><span class="p">(</span><span class="n">requested_reps</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_requested_text_reps" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Returns the requested Text representations of the crystal structure in a dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>requested_reps</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of representations to return.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the requested text representations of the crystal structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_requested_text_reps</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">requested_reps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the requested Text representations of the crystal structure in a dictionary.</span>

<span class="sd">    Args:</span>
<span class="sd">        requested_reps (List[str]): The list of representations to return.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing the requested text representations of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;cif_symmetrized&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cif_string</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;symmetrized&quot;</span><span class="p">,</span>
            <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;slices&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_slices</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;composition&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_composition</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;crystal_text_llm&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_crystal_text_llm</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;robocrys_rep&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_robocrys_rep</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;atom_sequences&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
            <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;atom_sequences_plusplus&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_sequences_plusplus</span><span class="p">,</span>
            <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">decimal_places</span><span class="o">=</span><span class="n">decimal_places</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;zmatrix&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_zmatrix_rep</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">requested_reps</span> <span class="o">==</span> <span class="s2">&quot;local_env&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safe_call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_env_rep</span><span class="p">,</span> <span class="n">local_env_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_robocrys_rep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_robocrys_rep</span><span class="p">()</span></code>

<a href="#mattext.representations.TextRep.get_robocrys_rep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_robocrys_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    https://github.com/hackingmaterials/robocrystallographer/tree/main</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">condensed_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condenser</span><span class="o">.</span><span class="n">condense_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">describer</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">condensed_structure</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_slices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_slices</span><span class="p">(</span><span class="n">primitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_slices" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Returns SLICES representation of the crystal structure.
https://www.nature.com/articles/s41467-023-42870-7</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>primitive</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the primitive structure or not.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The SLICE representation of the crystal structure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns SLICES representation of the crystal structure.</span>
<span class="sd">    https://www.nature.com/articles/s41467-023-42870-7</span>

<span class="sd">    Args:</span>
<span class="sd">        primitive (bool): Whether to use the primitive structure or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The SLICE representation of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">primitive</span><span class="p">:</span>
        <span class="n">primitive_structure</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_primitive_structure</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># convert to primitive structure</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">structure2SLICES</span><span class="p">(</span><span class="n">primitive_structure</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">structure2SLICES</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_wyckoff_positions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wyckoff_positions</span><span class="p">()</span></code>

<a href="#mattext.representations.TextRep.get_wyckoff_positions" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Getting wyckoff positions of the elements in the unit cell as the combination of...
number and letter.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A multi-line string that contain elements of the unit cell along with their wyckoff position in each line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="hint" open>
  <summary>Hint</summary>
  <p>At the end of the string, there is an additional newline character.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_wyckoff_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Getting wyckoff positions of the elements in the unit cell as the combination of...</span>
<span class="sd">    number and letter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str:  A multi-line string that contain elements of the unit cell along with their wyckoff position in each line.</span>

<span class="sd">    Hint:</span>
<span class="sd">        At the end of the string, there is an additional newline character.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spacegroup_analyzer</span> <span class="o">=</span> <span class="n">SpacegroupAnalyzer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
    <span class="n">wyckoff_sites</span> <span class="o">=</span> <span class="n">spacegroup_analyzer</span><span class="o">.</span><span class="n">get_symmetry_dataset</span><span class="p">()</span>
    <span class="n">element_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">site</span><span class="o">.</span><span class="n">specie</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">sites</span><span class="p">]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">])):</span>
        <span class="n">sub_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">element_symbols</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;wyckoffs&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
            <span class="n">wyckoff_sites</span><span class="p">[</span><span class="s2">&quot;equivalent_atoms&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_data</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">output</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_wycryst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wycryst</span><span class="p">()</span></code>

<a href="#mattext.representations.TextRep.get_wycryst" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">



<details class="obtaining-the-wyckoff-representation-for-crystal-structures-that-include" open>
  <summary>Obtaining the wyckoff representation for crystal structures that include</summary>
  <p>chemical formula
space group number
elements of the unit cell with their wyckoff positions.</p>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A multi-line string that contains the chemical formula, space group number,
and the elements of the unit cell with their wyckoff positions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_wycryst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtaining the wyckoff representation for crystal structures that include:</span>
<span class="sd">        chemical formula</span>
<span class="sd">        space group number</span>
<span class="sd">        elements of the unit cell with their wyckoff positions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: A multi-line string that contains the chemical formula, space group number,</span>
<span class="sd">            and the elements of the unit cell with their wyckoff positions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">chemical_formula</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">formula</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="n">chemical_formula</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_space_group_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wyckoff_positions</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.get_zmatrix_rep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_zmatrix_rep</span><span class="p">(</span><span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.get_zmatrix_rep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Generate the Z-matrix representation of the crystal structure.
It provides a description of each atom in terms of its atomic number,
bond length, bond angle, and dihedral angle, the so-called internal coordinates.</p>
<p>Disclaimer: The Z-matrix is meant for molecules, current implementation converts atoms within unit cell to molecule.
Hence the current implentation might overlook bonds acrosse unit cells.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_zmatrix_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate the Z-matrix representation of the crystal structure.</span>
<span class="sd">    It provides a description of each atom in terms of its atomic number,</span>
<span class="sd">    bond length, bond angle, and dihedral angle, the so-called internal coordinates.</span>

<span class="sd">    Disclaimer: The Z-matrix is meant for molecules, current implementation converts atoms within unit cell to molecule.</span>
<span class="sd">    Hence the current implentation might overlook bonds acrosse unit cells.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">species</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">s</span><span class="o">.</span><span class="n">element</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;element&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">species</span>
    <span class="p">]</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cart_coords</span><span class="p">]</span>
    <span class="n">molecule_</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span>
        <span class="n">species</span><span class="p">,</span>
        <span class="n">coords</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">zmatrix</span> <span class="o">=</span> <span class="n">molecule_</span><span class="o">.</span><span class="n">get_zmatrix</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">updated_zmatrix_rep</span><span class="p">(</span><span class="n">zmatrix</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.round_numbers_in_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">round_numbers_in_string</span><span class="p">(</span><span class="n">original_string</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#mattext.representations.TextRep.round_numbers_in_string" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Rounds float numbers in the given string to the specified number of decimal places using regex.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>original_string</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decimal_places</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of decimal places to round to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The string with the float numbers rounded to the specified number of decimal places.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">round_numbers_in_string</span><span class="p">(</span><span class="n">original_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">decimal_places</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rounds float numbers in the given string to the specified number of decimal places using regex.</span>

<span class="sd">    Args:</span>
<span class="sd">        original_string (str): The input string.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The string with the float numbers rounded to the specified number of decimal places.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\b\d+\.\d+\b&quot;</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">original_string</span><span class="p">)</span>
    <span class="n">rounded_numbers</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="p">),</span> <span class="n">decimal_places</span><span class="p">)</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
    <span class="n">new_string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
        <span class="n">pattern</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">rounded_numbers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="n">original_string</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">new_string</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="mattext.representations.TextRep.updated_zmatrix_rep" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">updated_zmatrix_rep</span><span class="p">(</span><span class="n">zmatrix</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#mattext.representations.TextRep.updated_zmatrix_rep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <div class="highlight"><pre><span></span><code>    Replace the variables in the Z-matrix with their values and return the updated Z-matrix.
    for eg: z-matrix from pymatgen
    &#39;N
</code></pre></div>
<p>N 1 B1
N 1 B2 2 A2
N 1 B3 2 A3 3 D3</p>
<div class="highlight"><pre><span></span><code>    B1=3.79
    B2=6.54
    ....
    is replaced to
    &#39;N
</code></pre></div>
<p>N 1 3.79
N 1 6.54 2 90
N 1 6.54 2 90 3 120
'</p>
<div class="highlight"><pre><span></span><code>    Args:
        Zmatrix (bool): zmatrix multi line string as implemented in pymatgen.
        decimal_places (int): The number of decimal places to round to.

    Returns:
        str: The updated Z-matrix representation of the crystal structure.
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/core.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">updated_zmatrix_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zmatrix</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace the variables in the Z-matrix with their values and return the updated Z-matrix.</span>
<span class="sd">    for eg: z-matrix from pymatgen</span>
<span class="sd">    &#39;N\nN 1 B1\nN 1 B2 2 A2\nN 1 B3 2 A3 3 D3\n</span>
<span class="sd">    B1=3.79</span>
<span class="sd">    B2=6.54</span>
<span class="sd">    ....</span>
<span class="sd">    is replaced to</span>
<span class="sd">    &#39;N\nN 1 3.79\nN 1 6.54 2 90\nN 1 6.54 2 90 3 120\n&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        Zmatrix (bool): zmatrix multi line string as implemented in pymatgen.</span>
<span class="sd">        decimal_places (int): The number of decimal places to round to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The updated Z-matrix representation of the crystal structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">zmatrix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">main_part</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">variables_part</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Determine the main part and the variables part of the Z-matrix</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">variables_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># Skip empty lines</span>
                <span class="n">main_part</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># Extract variables from the variables part</span>
    <span class="n">variable_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">var_line</span> <span class="ow">in</span> <span class="n">variables_part</span><span class="p">:</span>
        <span class="n">var</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">var_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">):</span>
            <span class="n">rounded_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">decimal_places</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rounded_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">())))</span>
        <span class="n">variable_dict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rounded_value</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">))</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rounded_value</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">decimal_places</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Replace variables in the main part</span>
    <span class="n">replaced_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">main_part</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c1"># atom = parts[0]</span>
        <span class="n">replaced_line</span> <span class="o">=</span> <span class="n">line</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)):</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variable_dict</span><span class="p">:</span>
                <span class="n">replaced_line</span> <span class="o">=</span> <span class="n">replaced_line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">variable_dict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
        <span class="n">replaced_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">replaced_line</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">replaced_lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="decoding">Decoding<a class="headerlink" href="#decoding" title="Permanent link">🔗</a></h3>


<div class="doc doc-object doc-module">



<a id="mattext.representations.decoder"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.representations.decoder.DecodeTextRep" class="doc doc-heading">
            <code>DecodeTextRep</code>


<a href="#mattext.representations.decoder.DecodeTextRep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DecodeTextRep</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">wyckoff_decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generating a pymatgen object from the output of the get_wyckoff_rep() method by using...</span>
<span class="sd">        pyxtal package. In this method, all data are extracted from the multi-line string of the...</span>
<span class="sd">        mentioned method.</span>
<span class="sd">        In pyxtal package, a 3D crystal is produced by specifying the dimensions, elements,</span>
<span class="sd">        composition of elements, space group, and sites as wyckoff positions of the elements.</span>

<span class="sd">        Params:</span>
<span class="sd">            lattice_params: boolean</span>
<span class="sd">                To specify whether use lattice parameters in generating crystal structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pmg_struc: pymatgen.core.structure.Structure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Always dimension is 3.</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">spg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">wyckoff_sites</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0123456789&quot;</span><span class="p">)</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span> <span class="p">:]</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="n">composition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>

        <span class="n">sites</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">sub_site</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">wyckoff_sites</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">site</span><span class="p">:</span>
                    <span class="n">sub_site</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_site</span><span class="p">)</span>

        <span class="n">xtal_struc</span> <span class="o">=</span> <span class="n">pyxtal</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">lattice_params</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice_parameters</span><span class="p">()</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">pyLattice</span><span class="o">.</span><span class="n">from_para</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">xtal_struc</span><span class="o">.</span><span class="n">from_random</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">spg</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xtal_struc</span><span class="o">.</span><span class="n">from_random</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">spg</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">)</span>

        <span class="n">pmg_struc</span> <span class="o">=</span> <span class="n">xtal_struc</span><span class="o">.</span><span class="n">to_pymatgen</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pmg_struc</span>

    <span class="k">def</span> <span class="nf">llm_decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returning pymatgen structure out of multi-line representation.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pymatgen.core.structure.Structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)]</span>
            <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cif_string_decoder_p1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returning a pymatgen structure out of a string format of a cif file.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pymatgen.core.structure.Structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
            <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot; _atom_site_occupancy&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>

        <span class="k">return</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cif_string_decoder_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returning a pymatgen structure out of a string format of a symmetrized cif file.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pymatgen.core.structure.Structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">spg</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
            <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="p">)</span>

        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot; _atom_site_occupancy&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>

        <span class="c1"># print(atoms)</span>

        <span class="k">return</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="n">spg</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.DecodeTextRep.cif_string_decoder_p1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cif_string_decoder_p1</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.DecodeTextRep.cif_string_decoder_p1" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Returning a pymatgen structure out of a string format of a cif file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pymatgen.core.structure.Structure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cif_string_decoder_p1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returning a pymatgen structure out of a string format of a cif file.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pymatgen.core.structure.Structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
        <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
        <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot; _atom_site_occupancy&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>

    <span class="k">return</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.DecodeTextRep.cif_string_decoder_sym" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cif_string_decoder_sym</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.DecodeTextRep.cif_string_decoder_sym" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Returning a pymatgen structure out of a string format of a symmetrized cif file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pymatgen.core.structure.Structure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cif_string_decoder_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returning a pymatgen structure out of a string format of a symmetrized cif file.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pymatgen.core.structure.Structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;   &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">spg</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
        <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
        <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="n">entities</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot; _atom_site_occupancy&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;  &quot;</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>

    <span class="c1"># print(atoms)</span>

    <span class="k">return</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_spacegroup</span><span class="p">(</span><span class="n">spg</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.DecodeTextRep.llm_decoder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">llm_decoder</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.DecodeTextRep.llm_decoder" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Returning pymatgen structure out of multi-line representation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pymatgen.core.structure.Structure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">llm_decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returning pymatgen structure out of multi-line representation.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pymatgen.core.structure.Structure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">Lattice</span><span class="o">.</span><span class="n">from_parameters</span><span class="p">(</span>
        <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">c</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">lengths</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
        <span class="n">alpha</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">beta</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">gamma</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m_coord</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">coordinates</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)]</span>
        <span class="n">m_coord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Structure</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">m_coord</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.DecodeTextRep.wyckoff_decoder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wyckoff_decoder</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.DecodeTextRep.wyckoff_decoder" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Generating a pymatgen object from the output of the get_wyckoff_rep() method by using...
pyxtal package. In this method, all data are extracted from the multi-line string of the...
mentioned method.
In pyxtal package, a 3D crystal is produced by specifying the dimensions, elements,
composition of elements, space group, and sites as wyckoff positions of the elements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_params</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boolean
To specify whether use lattice parameters in generating crystal structure.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>pmg_struc</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pymatgen.core.structure.Structure</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wyckoff_decoder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generating a pymatgen object from the output of the get_wyckoff_rep() method by using...</span>
<span class="sd">    pyxtal package. In this method, all data are extracted from the multi-line string of the...</span>
<span class="sd">    mentioned method.</span>
<span class="sd">    In pyxtal package, a 3D crystal is produced by specifying the dimensions, elements,</span>
<span class="sd">    composition of elements, space group, and sites as wyckoff positions of the elements.</span>

<span class="sd">    Params:</span>
<span class="sd">        lattice_params: boolean</span>
<span class="sd">            To specify whether use lattice parameters in generating crystal structure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pmg_struc: pymatgen.core.structure.Structure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Always dimension is 3.</span>
    <span class="n">dimensions</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">entities</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">spg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">wyckoff_sites</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">composition</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">atom</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;0123456789&quot;</span><span class="p">)</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">el</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span> <span class="p">:]</span>
        <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">composition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">number</span><span class="p">))</span>

    <span class="n">sites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
        <span class="n">sub_site</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="n">wyckoff_sites</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">site</span><span class="p">:</span>
                <span class="n">sub_site</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">sites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_site</span><span class="p">)</span>

    <span class="n">xtal_struc</span> <span class="o">=</span> <span class="n">pyxtal</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">lattice_params</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lattice_parameters</span><span class="p">()</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">pyLattice</span><span class="o">.</span><span class="n">from_para</span><span class="p">(</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">xtal_struc</span><span class="o">.</span><span class="n">from_random</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">spg</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="n">cell</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xtal_struc</span><span class="o">.</span><span class="n">from_random</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">spg</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">)</span>

    <span class="n">pmg_struc</span> <span class="o">=</span> <span class="n">xtal_struc</span><span class="o">.</span><span class="n">to_pymatgen</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">pmg_struc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.representations.decoder.MatchRep" class="doc doc-heading">
            <code>MatchRep</code>


<a href="#mattext.representations.decoder.MatchRep" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MatchRep</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">textrep</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">textrep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>

    <span class="k">def</span> <span class="nf">wyckoff_matcher</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To check if pymatgen object from the original cif file match with the generated...</span>
<span class="sd">        pymatgen structure from wyckoff_decoder method out of wyckoff representation...</span>
<span class="sd">        using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">        Params:</span>
<span class="sd">            StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">                https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>
<span class="sd">            lattice_params: bool</span>
<span class="sd">                To specify using lattice parameters in the wyckoff_decoder method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            StructureMatcher().fit_anonymous(): bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>

        <span class="c1"># output_struct = self.wyckoff_decoder(input, lattice_params)</span>
        <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">wyckoff_decoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
            <span class="n">ltol</span><span class="p">,</span>
            <span class="n">stol</span><span class="p">,</span>
            <span class="n">angle_tol</span><span class="p">,</span>
            <span class="n">primitive_cell</span><span class="p">,</span>
            <span class="n">scale</span><span class="p">,</span>
            <span class="n">allow_subset</span><span class="p">,</span>
            <span class="n">attempt_supercell</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit_anonymous</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">llm_matcher</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">        pymatgen structure from llm_decoder method out of llm representation</span>
<span class="sd">        using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">            StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">                https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">        Returns:</span>
<span class="sd">            StructureMatcher().fit(): bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">llm_decoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
            <span class="n">ltol</span><span class="p">,</span>
            <span class="n">stol</span><span class="p">,</span>
            <span class="n">angle_tol</span><span class="p">,</span>
            <span class="n">primitive_cell</span><span class="p">,</span>
            <span class="n">scale</span><span class="p">,</span>
            <span class="n">allow_subset</span><span class="p">,</span>
            <span class="n">attempt_supercell</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cif_string_matcher_sym</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="c1">#        input: str,</span>
        <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">        pymatgen structure from cif_string_decoder_sym method out of string cif representation.</span>
<span class="sd">        using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">            StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">                https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">        Returns:</span>
<span class="sd">            StructureMatcher().fit(): bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">cif_string_decoder_sym</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
            <span class="n">ltol</span><span class="p">,</span>
            <span class="n">stol</span><span class="p">,</span>
            <span class="n">angle_tol</span><span class="p">,</span>
            <span class="n">primitive_cell</span><span class="p">,</span>
            <span class="n">scale</span><span class="p">,</span>
            <span class="n">allow_subset</span><span class="p">,</span>
            <span class="n">attempt_supercell</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cif_string_matcher_p1</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">        pymatgen structure from cif_string_decoder_p1 method out of string cif representation</span>
<span class="sd">        using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">        Params:</span>
<span class="sd">            input: str</span>
<span class="sd">                String to obtain the items needed for the structure.</span>

<span class="sd">            StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">                https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">        Returns:</span>
<span class="sd">            StructureMatcher().fit(): bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">cif_string_decoder_p1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
            <span class="n">ltol</span><span class="p">,</span>
            <span class="n">stol</span><span class="p">,</span>
            <span class="n">angle_tol</span><span class="p">,</span>
            <span class="n">primitive_cell</span><span class="p">,</span>
            <span class="n">scale</span><span class="p">,</span>
            <span class="n">allow_subset</span><span class="p">,</span>
            <span class="n">attempt_supercell</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.MatchRep.cif_string_matcher_p1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cif_string_matcher_p1</span><span class="p">(</span><span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.MatchRep.cif_string_matcher_p1" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>To check if pymatgen object from the original cif file match with the generated
pymatgen structure from cif_string_decoder_p1 method out of string cif representation
using fit() method of StructureMatcher module in pymatgen package.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>StructureMatcher</code>
            </td>
            <td>
                  <code>module can be access in below link with its parameters</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StructureMatcher</code></td>            <td>
                  <code>).fit(</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cif_string_matcher_p1</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">    pymatgen structure from cif_string_decoder_p1 method out of string cif representation</span>
<span class="sd">    using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">        StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">            https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">    Returns:</span>
<span class="sd">        StructureMatcher().fit(): bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">cif_string_decoder_p1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
        <span class="n">ltol</span><span class="p">,</span>
        <span class="n">stol</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.MatchRep.cif_string_matcher_sym" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cif_string_matcher_sym</span><span class="p">(</span><span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.MatchRep.cif_string_matcher_sym" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>To check if pymatgen object from the original cif file match with the generated
pymatgen structure from cif_string_decoder_sym method out of string cif representation.
using fit() method of StructureMatcher module in pymatgen package.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>StructureMatcher</code>
            </td>
            <td>
                  <code>module can be access in below link with its parameters</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StructureMatcher</code></td>            <td>
                  <code>).fit(</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cif_string_matcher_sym</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="c1">#        input: str,</span>
    <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">    pymatgen structure from cif_string_decoder_sym method out of string cif representation.</span>
<span class="sd">    using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">        StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">            https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">    Returns:</span>
<span class="sd">        StructureMatcher().fit(): bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">cif_string_decoder_sym</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
        <span class="n">ltol</span><span class="p">,</span>
        <span class="n">stol</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.MatchRep.llm_matcher" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">llm_matcher</span><span class="p">(</span><span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.MatchRep.llm_matcher" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>To check if pymatgen object from the original cif file match with the generated
pymatgen structure from llm_decoder method out of llm representation
using fit() method of StructureMatcher module in pymatgen package.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str
String to obtain the items needed for the structure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>StructureMatcher</code>
            </td>
            <td>
                  <code>module can be access in below link with its parameters</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StructureMatcher</code></td>            <td>
                  <code>).fit(</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">llm_matcher</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To check if pymatgen object from the original cif file match with the generated</span>
<span class="sd">    pymatgen structure from llm_decoder method out of llm representation</span>
<span class="sd">    using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">    Params:</span>
<span class="sd">        input: str</span>
<span class="sd">            String to obtain the items needed for the structure.</span>

<span class="sd">        StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">            https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>

<span class="sd">    Returns:</span>
<span class="sd">        StructureMatcher().fit(): bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
    <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">llm_decoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
        <span class="n">ltol</span><span class="p">,</span>
        <span class="n">stol</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.representations.decoder.MatchRep.wyckoff_matcher" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wyckoff_matcher</span><span class="p">(</span><span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lattice_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mattext.representations.decoder.MatchRep.wyckoff_matcher" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>To check if pymatgen object from the original cif file match with the generated...
pymatgen structure from wyckoff_decoder method out of wyckoff representation...
using fit() method of StructureMatcher module in pymatgen package.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>StructureMatcher</code>
            </td>
            <td>
                  <code>module can be access in below link with its parameters</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lattice_params</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool
To specify using lattice parameters in the wyckoff_decoder method.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StructureMatcher</code></td>            <td>
                  <code>).fit_anonymous(</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/decoder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">wyckoff_matcher</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">ltol</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">stol</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">angle_tol</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">primitive_cell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_subset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">attempt_supercell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lattice_params</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To check if pymatgen object from the original cif file match with the generated...</span>
<span class="sd">    pymatgen structure from wyckoff_decoder method out of wyckoff representation...</span>
<span class="sd">    using fit() method of StructureMatcher module in pymatgen package.</span>

<span class="sd">    Params:</span>
<span class="sd">        StructureMatcher module can be access in below link with its parameters:</span>
<span class="sd">            https://pymatgen.org/pymatgen.analysis.html#pymatgen.analysis.structure_matcher.StructureMatcher.get_mapping</span>
<span class="sd">        lattice_params: bool</span>
<span class="sd">            To specify using lattice parameters in the wyckoff_decoder method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        StructureMatcher().fit_anonymous(): bool</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">original_struct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>

    <span class="c1"># output_struct = self.wyckoff_decoder(input, lattice_params)</span>
    <span class="n">output_struct</span> <span class="o">=</span> <span class="n">DecodeTextRep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">wyckoff_decoder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">lattice_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StructureMatcher</span><span class="p">(</span>
        <span class="n">ltol</span><span class="p">,</span>
        <span class="n">stol</span><span class="p">,</span>
        <span class="n">angle_tol</span><span class="p">,</span>
        <span class="n">primitive_cell</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">,</span>
        <span class="n">allow_subset</span><span class="p">,</span>
        <span class="n">attempt_supercell</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit_anonymous</span><span class="p">(</span><span class="n">output_struct</span><span class="p">,</span> <span class="n">original_struct</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="transformations">Transformations<a class="headerlink" href="#transformations" title="Permanent link">🔗</a></h3>


<div class="doc doc-object doc-module">



<a id="mattext.representations.transformations"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">











  </div>

    </div>

</div><h2 id="tokenizer">Tokenizer<a class="headerlink" href="#tokenizer" title="Permanent link">🔗</a></h2>


<div class="doc doc-object doc-module">



<a id="mattext.tokenizer"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.CifTokenizer" class="doc doc-heading">
            <code>CifTokenizer</code>


<a href="#mattext.tokenizer.CifTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xtal2txt.tokenizer.Xtal2txtTokenizer">Xtal2txtTokenizer</span></code></p>







              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CifTokenizer</span><span class="p">(</span><span class="n">Xtal2txtTokenizer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">special_num_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">vocab_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model_max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">padding_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">special_num_token</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">CIF_RT_VOCAB</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">CIF_VOCAB</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CifTokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">special_num_token</span><span class="p">,</span>
            <span class="n">vocab_file</span><span class="o">=</span><span class="n">vocab_file</span><span class="p">,</span>
            <span class="n">model_max_length</span><span class="o">=</span><span class="n">model_max_length</span><span class="p">,</span>
            <span class="n">padding_length</span><span class="o">=</span><span class="n">padding_length</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">        token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
        <span class="n">token_type</span> <span class="o">=</span> <span class="n">CIF_ANALYSIS_DICT</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.CifTokenizer.token_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_analysis</span><span class="p">(</span><span class="n">list_of_tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.CifTokenizer.token_analysis" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The
token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">    token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
    <span class="n">token_type</span> <span class="o">=</span> <span class="n">CIF_ANALYSIS_DICT</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.CompositionTokenizer" class="doc doc-heading">
            <code>CompositionTokenizer</code>


<a href="#mattext.tokenizer.CompositionTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xtal2txt.tokenizer.Xtal2txtTokenizer">Xtal2txtTokenizer</span></code></p>







              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CompositionTokenizer</span><span class="p">(</span><span class="n">Xtal2txtTokenizer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">special_num_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">vocab_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model_max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">padding_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">special_num_token</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">COMPOSITION_RT_VOCAB</span> <span class="k">if</span> <span class="n">vocab_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vocab_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">COMPOSITION_VOCAB</span> <span class="k">if</span> <span class="n">vocab_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vocab_file</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompositionTokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">special_num_token</span><span class="p">,</span>
            <span class="n">vocab_file</span><span class="o">=</span><span class="n">vocab_file</span><span class="p">,</span>
            <span class="n">model_max_length</span><span class="o">=</span><span class="n">model_max_length</span><span class="p">,</span>
            <span class="n">padding_length</span><span class="o">=</span><span class="n">padding_length</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">        token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
        <span class="n">token_type</span> <span class="o">=</span> <span class="n">COMPOSITION_ANALYSIS_DICT</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.CompositionTokenizer.token_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_analysis</span><span class="p">(</span><span class="n">list_of_tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.CompositionTokenizer.token_analysis" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The
token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">    token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
    <span class="n">token_type</span> <span class="o">=</span> <span class="n">COMPOSITION_ANALYSIS_DICT</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.CrysllmTokenizer" class="doc doc-heading">
            <code>CrysllmTokenizer</code>


<a href="#mattext.tokenizer.CrysllmTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xtal2txt.tokenizer.Xtal2txtTokenizer">Xtal2txtTokenizer</span></code></p>







              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CrysllmTokenizer</span><span class="p">(</span><span class="n">Xtal2txtTokenizer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">special_num_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">vocab_file</span><span class="o">=</span><span class="n">CRYSTAL_LLM_VOCAB</span><span class="p">,</span>
        <span class="n">model_max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">padding_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">special_num_token</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">CRYSTAL_LLM_RT_VOCAB</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">CRYSTAL_LLM_VOCAB</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CrysllmTokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">special_num_token</span><span class="p">,</span>
            <span class="n">vocab_file</span><span class="o">=</span><span class="n">vocab_file</span><span class="p">,</span>
            <span class="n">model_max_length</span><span class="o">=</span><span class="n">model_max_length</span><span class="p">,</span>
            <span class="n">padding_length</span><span class="o">=</span><span class="n">padding_length</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">        token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
        <span class="n">token_type</span> <span class="o">=</span> <span class="n">CRYSTAL_LLM_ANALYSIS_DICT</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.CrysllmTokenizer.token_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_analysis</span><span class="p">(</span><span class="n">list_of_tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.CrysllmTokenizer.token_analysis" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The
token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">    token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
    <span class="n">token_type</span> <span class="o">=</span> <span class="n">CRYSTAL_LLM_ANALYSIS_DICT</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.NumTokenizer" class="doc doc-heading">
            <code>NumTokenizer</code>


<a href="#mattext.tokenizer.NumTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">


        <p>Tokenize numbers as implemented in Regression Transformer.
https://www.nature.com/articles/s42256-023-00639-z
https://github.com/IBM/regression-transformer/tree/main</p>






              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">NumTokenizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tokenize numbers as implemented in Regression Transformer.</span>
<span class="sd">    https://www.nature.com/articles/s42256-023-00639-z</span>
<span class="sd">    https://github.com/IBM/regression-transformer/tree/main&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tokenizer for numbers.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\+|-)?(\d+)(\.)?(\d+)?\s*&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">num_matcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract numbers from a sentence and replace them with tokens.&quot;&quot;&quot;</span>
        <span class="c1"># pattern = re.findall(r&#39;(\d+\.\d+|\d+)&#39;, text)  # This regex captures both whole numbers and decimal numbers</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;\d+(?:\.\d+)?&quot;</span>  <span class="c1"># Match any number, whether it is part of a string or not</span>
        <span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span>
            <span class="n">matches</span>
        <span class="p">):</span>  <span class="c1"># since we are replacing substring with a bigger subtring the string we are working on</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">replacement</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">replacement</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tokenization of numbers as in RT.</span>
<span class="sd">         &#39;0.9&#39; -&gt; &#39;_0_0_&#39;, &#39;_._&#39;, &#39;_9_-1_&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            text: number as string to be tokenized.</span>

<span class="sd">        Returns:</span>
<span class="sd">            extracted tokens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">matched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
            <span class="n">sign</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">decimals</span> <span class="o">=</span> <span class="n">matched</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">]</span>
            <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">units</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dot</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">dot</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">decimals</span><span class="p">:</span>
                <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">_-</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_&quot;</span>
                    <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">decimals</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="n">tokens</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert_tokens_to_float</span><span class="p">(</span><span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts tokens representing a float value into a float.</span>
<span class="sd">        NOTE: Expects that non-floating tokens are strippped off</span>

<span class="sd">        Args:</span>
<span class="sd">            tokens: List of tokens, each representing a float.</span>
<span class="sd">                E.g.: [&#39;_0_0_&#39;, &#39;_._&#39;, &#39;_9_-1_&#39;, &#39;_3_-2_&#39;, &#39;_1_-3_&#39;]</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Float representation for the list of tokens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">float_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">])</span>
            <span class="n">float_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">float_string</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">float_value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="n">float_value</span>

    <span class="k">def</span> <span class="nf">convert_tokens_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts tokens to string.</span>

<span class="sd">        Args:</span>
<span class="sd">            tokens: List of tokens.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: String representation of the tokens.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.NumTokenizer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

<a href="#mattext.tokenizer.NumTokenizer.__init__" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Tokenizer for numbers.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tokenizer for numbers.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\+|-)?(\d+)(\.)?(\d+)?\s*&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.NumTokenizer.convert_tokens_to_float" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_tokens_to_float</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#mattext.tokenizer.NumTokenizer.convert_tokens_to_float" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Converts tokens representing a float value into a float.
NOTE: Expects that non-floating tokens are strippped off</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tokens</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tokens, each representing a float.
E.g.: ['<em>0_0</em>', '<em>.</em>', '<em>9</em>-1_', '<em>3</em>-2_', '<em>1</em>-3_']</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Float representation for the list of tokens.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">convert_tokens_to_float</span><span class="p">(</span><span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts tokens representing a float value into a float.</span>
<span class="sd">    NOTE: Expects that non-floating tokens are strippped off</span>

<span class="sd">    Args:</span>
<span class="sd">        tokens: List of tokens, each representing a float.</span>
<span class="sd">            E.g.: [&#39;_0_0_&#39;, &#39;_._&#39;, &#39;_9_-1_&#39;, &#39;_3_-2_&#39;, &#39;_1_-3_&#39;]</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Float representation for the list of tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">float_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">])</span>
        <span class="n">float_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">float_string</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">float_value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">float_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.NumTokenizer.convert_tokens_to_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_tokens_to_string</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.NumTokenizer.convert_tokens_to_string" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Converts tokens to string.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tokens</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of tokens.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representation of the tokens.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_tokens_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts tokens to string.</span>

<span class="sd">    Args:</span>
<span class="sd">        tokens: List of tokens.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: String representation of the tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.NumTokenizer.num_matcher" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_matcher</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.NumTokenizer.num_matcher" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Extract numbers from a sentence and replace them with tokens.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">num_matcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract numbers from a sentence and replace them with tokens.&quot;&quot;&quot;</span>
    <span class="c1"># pattern = re.findall(r&#39;(\d+\.\d+|\d+)&#39;, text)  # This regex captures both whole numbers and decimal numbers</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;\d+(?:\.\d+)?&quot;</span>  <span class="c1"># Match any number, whether it is part of a string or not</span>
    <span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span>
        <span class="n">matches</span>
    <span class="p">):</span>  <span class="c1"># since we are replacing substring with a bigger subtring the string we are working on</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
        <span class="n">replacement</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[:</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">replacement</span> <span class="o">+</span> <span class="n">text</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.NumTokenizer.tokenize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.NumTokenizer.tokenize" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Tokenization of numbers as in RT.
 '0.9' -&gt; '<em>0_0</em>', '<em>.</em>', '<em>9</em>-1_'</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number as string to be tokenized.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>extracted tokens.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tokenization of numbers as in RT.</span>
<span class="sd">     &#39;0.9&#39; -&gt; &#39;_0_0_&#39;, &#39;_._&#39;, &#39;_9_-1_&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        text: number as string to be tokenized.</span>

<span class="sd">    Returns:</span>
<span class="sd">        extracted tokens.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matched</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matched</span><span class="p">:</span>
        <span class="n">sign</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">decimals</span> <span class="o">=</span> <span class="n">matched</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">]</span>
        <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_&quot;</span> <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">units</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dot</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">dot</span><span class="si">}</span><span class="s2">_&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">decimals</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">_-</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">_&quot;</span>
                <span class="k">for</span> <span class="n">position</span><span class="p">,</span> <span class="n">number</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">decimals</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">]</span>
    <span class="k">return</span> <span class="n">tokens</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.RobocrysTokenizer" class="doc doc-heading">
            <code>RobocrysTokenizer</code>


<a href="#mattext.tokenizer.RobocrysTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">


        <p>Tokenizer for Robocrystallographer. Would be BPE tokenizer.
trained on the Robocrystallographer dataset.
TODO: Implement this tokenizer.</p>






              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RobocrysTokenizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tokenizer for Robocrystallographer. Would be BPE tokenizer.</span>
<span class="sd">    trained on the Robocrystallographer dataset.</span>
<span class="sd">    TODO: Implement this tokenizer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vocab_file</span><span class="o">=</span><span class="n">ROBOCRYS_VOCAB</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">vocab_file</span><span class="p">)</span>
        <span class="n">wrapped_tokenizer</span> <span class="o">=</span> <span class="n">PreTrainedTokenizerFast</span><span class="p">(</span><span class="n">tokenizer_object</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span> <span class="o">=</span> <span class="n">wrapped_tokenizer</span>

    <span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token_ids</span><span class="p">,</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Check if token_ids is a string and convert it to a list of integers</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token_ids</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">token_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">token_ids</span><span class="p">)]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span>
            <span class="n">token_ids</span><span class="p">,</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="n">skip_special_tokens</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="mattext.tokenizer.SliceTokenizer" class="doc doc-heading">
            <code>SliceTokenizer</code>


<a href="#mattext.tokenizer.SliceTokenizer" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xtal2txt.tokenizer.Xtal2txtTokenizer">Xtal2txtTokenizer</span></code></p>







              <details class="quote">
                <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SliceTokenizer</span><span class="p">(</span><span class="n">Xtal2txtTokenizer</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">special_num_token</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">vocab_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model_max_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">padding_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">special_num_token</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">SLICE_RT_VOCAB</span> <span class="k">if</span> <span class="n">vocab_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vocab_file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_file</span> <span class="o">=</span> <span class="n">SLICE_VOCAB</span> <span class="k">if</span> <span class="n">vocab_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">vocab_file</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SliceTokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">special_num_token</span><span class="p">,</span>
            <span class="n">vocab_file</span><span class="o">=</span><span class="n">vocab_file</span><span class="p">,</span>
            <span class="n">model_max_length</span><span class="o">=</span><span class="n">model_max_length</span><span class="p">,</span>
            <span class="n">padding_length</span><span class="o">=</span><span class="n">padding_length</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert_tokens_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts tokens to string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_num_tokens</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">(</span>
                        <span class="n">token</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>
                        <span class="k">else</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">        token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
        <span class="n">token_type</span> <span class="o">=</span> <span class="n">SLICE_ANALYSIS_DICT</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.SliceTokenizer.convert_tokens_to_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_tokens_to_string</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.SliceTokenizer.convert_tokens_to_string" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Converts tokens to string.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_tokens_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts tokens to string.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_num_tokens</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">token</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">))</span>
                    <span class="k">else</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.tokenizer.SliceTokenizer.token_analysis" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">token_analysis</span><span class="p">(</span><span class="n">list_of_tokens</span><span class="p">)</span></code>

<a href="#mattext.tokenizer.SliceTokenizer.token_analysis" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The
token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</p>

            <details class="quote">
              <summary>Source code in <code>xtal2txt/tokenizer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">token_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tokens</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Takes tokens after tokenize and returns a list with replacing the tokens with their MASK token. The</span>
<span class="sd">    token type is determined from the dict declared globally, and the token is replaced with the corresponding MASK token.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">analysis_masks</span> <span class="o">=</span> <span class="n">ANALYSIS_MASK_TOKENS</span>
    <span class="n">token_type</span> <span class="o">=</span> <span class="n">SLICE_ANALYSIS_DICT</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">analysis_masks</span><span class="p">[</span><span class="nb">next</span><span class="p">((</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">token_type</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">list_of_tokens</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="models">Models<a class="headerlink" href="#models" title="Permanent link">🔗</a></h2>


<div class="doc doc-object doc-module">



<a id="mattext.models.benchmark"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.finetune"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.llama_sft"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.models.llama_sft.FinetuneLLamaSFT" class="doc doc-heading">
            <code>FinetuneLLamaSFT</code>


<a href="#mattext.models.llama_sft.FinetuneLLamaSFT" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">


        <p>Class to perform finetuning of a language model.
    Initialize the FinetuneModel.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the fine-tuning.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_rank</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local rank for distributed training. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/mattext/models/llama_sft.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FinetuneLLamaSFT</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to perform finetuning of a language model.</span>
<span class="sd">        Initialize the FinetuneModel.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg (DictConfig): Configuration for the fine-tuning.</span>
<span class="sd">        local_rank (int, optional): Local rank for distributed training. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">local_rank</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s2">&quot;fold_0&quot;</span><span class="p">,</span> <span class="n">test_sample_size</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold</span> <span class="o">=</span> <span class="n">fold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="o">=</span> <span class="n">local_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_repository</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data_repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_special_tokens</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_special_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_map</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">PROPERTY_MAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material_map</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">MATERIAL_MAP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">finetune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dataset_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">benchmark_dataset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">context_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataprep_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dataprep_seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pretrained_checkpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">bnb_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_test_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peft_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_model_tokenizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">material_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_sample_size</span> <span class="o">=</span> <span class="n">test_sample_size</span>

    <span class="k">def</span> <span class="nf">prepare_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_repository</span><span class="p">,</span> <span class="n">subset</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_sample_size</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_sample_size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="p">):</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_repository</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataprep_seed</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataprep_seed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_model_tokenizer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># device_string = PartialState().process_index</span>
        <span class="c1"># compute_dtype = getattr(torch, &quot;float16&quot;)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You can&#39;t load the model in 8 bits and 4 bits at the same time&quot;</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">:</span>
            <span class="n">compute_dtype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">torch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">bnb_4bit_compute_dtype</span><span class="p">)</span>
            <span class="n">bnb_config</span> <span class="o">=</span> <span class="n">BitsAndBytesConfig</span><span class="p">(</span>
                <span class="n">load_in_4bit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span><span class="p">,</span>
                <span class="n">load_in_8bit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">,</span>
                <span class="n">bnb_4bit_quant_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">bnb_4bit_quant_type</span><span class="p">,</span>
                <span class="n">bnb_4bit_compute_dtype</span><span class="o">=</span><span class="n">compute_dtype</span><span class="p">,</span>
                <span class="n">bnb_4bit_use_double_quant</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_nested_quant</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bnb_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Check GPU compatibility with bfloat16</span>
        <span class="k">if</span> <span class="n">compute_dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">:</span>
            <span class="n">major</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_capability</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Your GPU supports bfloat16: accelerate training with bf16=True!&quot;</span>
                <span class="p">)</span>

        <span class="c1"># LoRA config</span>
        <span class="n">peft_config</span> <span class="o">=</span> <span class="n">LoraConfig</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lora_config</span><span class="p">)</span>

        <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span><span class="p">,</span>
            <span class="n">use_fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">eos_token</span>
        <span class="n">tokenizer</span><span class="o">.</span><span class="n">padding_side</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForCausalLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span><span class="p">,</span>
            <span class="n">quantization_config</span><span class="o">=</span><span class="n">bnb_config</span><span class="p">,</span>
            <span class="n">device_map</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">peft_config</span>

    <span class="k">def</span> <span class="nf">formatting_prompts_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example</span><span class="p">):</span>
        <span class="n">output_texts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">])):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;### What is the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">property_</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> ### Answer: </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">@@@&quot;</span>
            <span class="n">output_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_texts</span>

    <span class="k">def</span> <span class="nf">formatting_tests_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example</span><span class="p">):</span>
        <span class="n">output_texts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">])):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;### What is the </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">property_</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> &quot;</span>
            <span class="n">output_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_texts</span>

    <span class="k">def</span> <span class="nf">_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainerCallback</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of callbacks for early stopping, and custom logging.&quot;&quot;&quot;</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EarlyStoppingCallback</span><span class="p">(</span>
                    <span class="n">early_stopping_patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_patience</span><span class="p">,</span>
                    <span class="n">early_stopping_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_threshold</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvaluateFirstStepCallback</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">callbacks</span>

    <span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform fine-tuning of the language model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
        <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
            <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

        <span class="n">response_template</span> <span class="o">=</span> <span class="s2">&quot; ### Answer:&quot;</span>
        <span class="n">collator</span> <span class="o">=</span> <span class="n">DataCollatorForCompletionOnlyLM</span><span class="p">(</span>
            <span class="n">response_template</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span>
        <span class="p">)</span>

        <span class="n">packing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">max_seq_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">==</span> <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span>
            <span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">2048</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">SFTTrainer</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">peft_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">peft_config</span><span class="p">,</span>
            <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
            <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
            <span class="n">formatting_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_prompts_func</span><span class="p">,</span>
            <span class="n">data_collator</span><span class="o">=</span><span class="n">collator</span><span class="p">,</span>
            <span class="n">max_seq_length</span><span class="o">=</span><span class="n">max_seq_length</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
            <span class="n">packing</span><span class="o">=</span><span class="n">packing</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">/llamav3-8b-lora-fine-tune&quot;</span>
        <span class="p">)</span>
        <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="n">pipe</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
            <span class="s2">&quot;text-generation&quot;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
            <span class="n">return_full_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">do_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_tests_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prediction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">_predictions.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="n">trainer</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_</span><span class="p">)</span>

        <span class="c1"># # Merge LoRA and base model</span>
        <span class="c1"># merged_model = trainer.model.merge_and_unload()</span>
        <span class="c1"># # Save the merged model</span>
        <span class="c1"># merged_model.save_pretrained(</span>
        <span class="c1">#     f&quot;{self.cfg.path.finetuned_modelname}_{self.fold}/llamav3-8b-lora-save-pretrained&quot;,</span>
        <span class="c1">#     save_config=True,</span>
        <span class="c1">#     safe_serialization=True,</span>
        <span class="c1"># )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">/llamav3-8b-lora-save-pretrained&quot;</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
            <span class="n">merge_pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_tests_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prediction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">merge_pred</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">_predictions_merged.json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merge_pred</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

        <span class="c1"># Empty VRAM</span>
        <span class="k">del</span> <span class="n">trainer</span>
        <span class="k">del</span> <span class="n">collator</span>
        <span class="k">del</span> <span class="n">pipe</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span>
        <span class="kn">import</span> <span class="nn">gc</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.models.llama_sft.FinetuneLLamaSFT.finetune" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finetune</span><span class="p">()</span></code>

<a href="#mattext.models.llama_sft.FinetuneLLamaSFT.finetune" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Perform fine-tuning of the language model.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/llama_sft.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform fine-tuning of the language model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
        <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

    <span class="n">response_template</span> <span class="o">=</span> <span class="s2">&quot; ### Answer:&quot;</span>
    <span class="n">collator</span> <span class="o">=</span> <span class="n">DataCollatorForCompletionOnlyLM</span><span class="p">(</span>
        <span class="n">response_template</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span>
    <span class="p">)</span>

    <span class="n">packing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">max_seq_length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">==</span> <span class="s2">&quot;cif_p1&quot;</span><span class="p">:</span>
        <span class="n">max_seq_length</span> <span class="o">=</span> <span class="mi">2048</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">SFTTrainer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">peft_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">peft_config</span><span class="p">,</span>
        <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
        <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
        <span class="n">formatting_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_prompts_func</span><span class="p">,</span>
        <span class="n">data_collator</span><span class="o">=</span><span class="n">collator</span><span class="p">,</span>
        <span class="n">max_seq_length</span><span class="o">=</span><span class="n">max_seq_length</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
        <span class="n">packing</span><span class="o">=</span><span class="n">packing</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">output_dir_</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">/llamav3-8b-lora-fine-tune&quot;</span>
    <span class="p">)</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="n">pipe</span> <span class="o">=</span> <span class="n">pipeline</span><span class="p">(</span>
        <span class="s2">&quot;text-generation&quot;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">trainer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
        <span class="n">return_full_text</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">do_sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">max_new_tokens</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_tests_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prediction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">_predictions.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir_</span><span class="p">)</span>

    <span class="c1"># # Merge LoRA and base model</span>
    <span class="c1"># merged_model = trainer.model.merge_and_unload()</span>
    <span class="c1"># # Save the merged model</span>
    <span class="c1"># merged_model.save_pretrained(</span>
    <span class="c1">#     f&quot;{self.cfg.path.finetuned_modelname}_{self.fold}/llamav3-8b-lora-save-pretrained&quot;,</span>
    <span class="c1">#     save_config=True,</span>
    <span class="c1">#     safe_serialization=True,</span>
    <span class="c1"># )</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">/llamav3-8b-lora-save-pretrained&quot;</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">amp</span><span class="o">.</span><span class="n">autocast</span><span class="p">():</span>
        <span class="n">merge_pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formatting_tests_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testdata</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Prediction: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">merge_pred</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold</span><span class="si">}</span><span class="s2">_predictions_merged.json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;w&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merge_pred</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>

    <span class="c1"># Empty VRAM</span>
    <span class="k">del</span> <span class="n">trainer</span>
    <span class="k">del</span> <span class="n">collator</span>
    <span class="k">del</span> <span class="n">pipe</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span>
    <span class="kn">import</span> <span class="nn">gc</span>

    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.llama"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.models.llama.FinetuneLLama" class="doc doc-heading">
            <code>FinetuneLLama</code>


<a href="#mattext.models.llama.FinetuneLLama" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">


        <p>Class to perform finetuning of LLama using
a regression head.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the fine-tuning.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_rank</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local rank for distributed training. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/mattext/models/llama.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FinetuneLLama</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to perform finetuning of LLama using</span>
<span class="sd">    a regression head.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg (DictConfig): Configuration for the fine-tuning.</span>
<span class="sd">        local_rank (int, optional): Local rank for distributed training. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">local_rank</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="o">=</span> <span class="n">local_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">finetune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">context_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pretrained_checkpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">bnb_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_model_tokenizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_datasets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetune_traindata</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_model_tokenizer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">llama_tokenizer</span> <span class="o">=</span> <span class="n">LlamaTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span><span class="p">,</span>
            <span class="n">model_max_length</span><span class="o">=</span><span class="n">MAX_LENGTH</span><span class="p">,</span>
            <span class="n">padding_side</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">use_fast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You can&#39;t load the model in 8 bits and 4 bits at the same time&quot;</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">:</span>
            <span class="n">compute_dtype</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">torch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">bnb_4bit_compute_dtype</span><span class="p">)</span>
            <span class="n">bnb_config</span> <span class="o">=</span> <span class="n">BitsAndBytesConfig</span><span class="p">(</span>
                <span class="n">load_in_4bit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_4bit</span><span class="p">,</span>
                <span class="n">load_in_8bit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_8bit</span><span class="p">,</span>
                <span class="n">bnb_4bit_quant_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">bnb_4bit_quant_type</span><span class="p">,</span>
                <span class="n">bnb_4bit_compute_dtype</span><span class="o">=</span><span class="n">compute_dtype</span><span class="p">,</span>
                <span class="n">bnb_4bit_use_double_quant</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bnb_config</span><span class="o">.</span><span class="n">use_nested_quant</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bnb_config</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Check GPU compatibility with bfloat16</span>
        <span class="k">if</span> <span class="n">compute_dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">:</span>
            <span class="n">major</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_capability</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">major</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your GPU supports bfloat16: accelerate training with bf16=True&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

        <span class="n">device_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">LlamaForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ckpt</span><span class="p">,</span>
            <span class="n">num_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">quantization_config</span><span class="o">=</span><span class="n">bnb_config</span><span class="p">,</span>
            <span class="n">device_map</span><span class="o">=</span><span class="n">device_map</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">lora_config</span> <span class="o">=</span> <span class="n">LoraConfig</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">lora_config</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">get_peft_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">lora_config</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">print_trainable_parameters</span><span class="p">()</span>

        <span class="n">special_tokens_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">pad_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">special_tokens_dict</span><span class="p">[</span><span class="s2">&quot;pad_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_PAD_TOKEN</span>
        <span class="k">if</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">eos_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">special_tokens_dict</span><span class="p">[</span><span class="s2">&quot;eos_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_EOS_TOKEN</span>
        <span class="k">if</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">bos_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">special_tokens_dict</span><span class="p">[</span><span class="s2">&quot;bos_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_BOS_TOKEN</span>
        <span class="k">if</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">unk_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">special_tokens_dict</span><span class="p">[</span><span class="s2">&quot;unk_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_UNK_TOKEN</span>

        <span class="n">smart_tokenizer_and_embedding_resize</span><span class="p">(</span>
            <span class="n">special_tokens_dict</span><span class="o">=</span><span class="n">special_tokens_dict</span><span class="p">,</span>
            <span class="n">llama_tokenizer</span><span class="o">=</span><span class="n">llama_tokenizer</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">llama_tokenizer</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">model</span><span class="p">,</span> <span class="n">llama_tokenizer</span>

    <span class="k">def</span> <span class="nf">_tokenize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">):</span>
        <span class="n">tokenized_examples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
            <span class="n">examples</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">],</span>
            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">tokenized_examples</span>

    <span class="k">def</span> <span class="nf">_prepare_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare training and validation datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">           path (Union[str, Path]): Path to json file containing the data</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetDict: Dictionary containing training and validation datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tokenize</span><span class="p">,</span> <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainerCallback</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of callbacks for early stopping, and custom logging.&quot;&quot;&quot;</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EarlyStoppingCallback</span><span class="p">(</span>
                    <span class="n">early_stopping_patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_patience</span><span class="p">,</span>
                    <span class="n">early_stopping_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_threshold</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">custom_logger</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomWandbCallback_FineTune</span><span class="p">())</span>

        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvaluateFirstStepCallback</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">callbacks</span>

    <span class="k">def</span> <span class="nf">_compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># Convert predictions to PyTorch tensor</span>
        <span class="n">label_ids</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">label_ids</span><span class="p">)</span>  <span class="c1"># Convert label_ids to PyTorch tensor</span>

        <span class="k">if</span> <span class="nb">eval</span><span class="p">:</span>
            <span class="c1"># Calculate RMSE as evaluation metric</span>
            <span class="n">eval_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">label_ids</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">eval_rmse</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate RMSE as training metric</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">label_ids</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;train_rmse&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform fine-tuning of the language model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

        <span class="c1"># os.environ[&quot;ACCELERATE_MIXED_PRECISION&quot;] = &quot;no&quot;</span>
        <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
            <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
            <span class="n">metric_for_best_model</span><span class="o">=</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">,</span>  <span class="c1"># Metric to use for determining the best model</span>
            <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Lower eval_rmse is better</span>
        <span class="p">)</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
            <span class="n">data_collator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">compute_metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
            <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
            <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)})</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">trainer</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">/llamav2-7b-lora-fine-tune&quot;</span>
        <span class="p">)</span>

        <span class="n">eval_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">])</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eval_result</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the fine-tuned model on the test dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.models.llama.FinetuneLLama.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">()</span></code>

<a href="#mattext.models.llama.FinetuneLLama.evaluate" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluate the fine-tuned model on the test dataset.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/llama.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the fine-tuned model on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.models.llama.FinetuneLLama.finetune" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finetune</span><span class="p">()</span></code>

<a href="#mattext.models.llama.FinetuneLLama.finetune" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Perform fine-tuning of the language model.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/llama.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform fine-tuning of the language model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

    <span class="c1"># os.environ[&quot;ACCELERATE_MIXED_PRECISION&quot;] = &quot;no&quot;</span>
    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
        <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
        <span class="n">metric_for_best_model</span><span class="o">=</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">,</span>  <span class="c1"># Metric to use for determining the best model</span>
        <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Lower eval_rmse is better</span>
    <span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
        <span class="n">data_collator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">compute_metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>
        <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
        <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)})</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">trainer</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="si">}</span><span class="s2">/llamav2-7b-lora-fine-tune&quot;</span>
    <span class="p">)</span>

    <span class="n">eval_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">])</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eval_result</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="mattext.models.llama.smart_tokenizer_and_embedding_resize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">smart_tokenizer_and_embedding_resize</span><span class="p">(</span><span class="n">special_tokens_dict</span><span class="p">,</span> <span class="n">llama_tokenizer</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

<a href="#mattext.models.llama.smart_tokenizer_and_embedding_resize" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">

        <p>Resize tokenizer and embedding.</p>
<p>Note: This is the unoptimized version that may make your embedding size not be divisible by 64.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/llama.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smart_tokenizer_and_embedding_resize</span><span class="p">(</span>
    <span class="n">special_tokens_dict</span><span class="p">,</span>
    <span class="n">llama_tokenizer</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resize tokenizer and embedding.</span>

<span class="sd">    Note: This is the unoptimized version that may make your embedding size not be divisible by 64.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_new_tokens</span> <span class="o">=</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">add_special_tokens</span><span class="p">(</span><span class="n">special_tokens_dict</span><span class="p">)</span>
    <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">add_special_tokens</span><span class="p">(</span><span class="n">special_tokens_dict</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">resize_token_embeddings</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">llama_tokenizer</span><span class="p">),</span> <span class="n">pad_to_multiple_of</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_new_tokens</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">input_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_input_embeddings</span><span class="p">()</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span>
        <span class="c1">#   output_embeddings = model.get_output_embeddings().weight.data</span>

        <span class="n">input_embeddings_avg</span> <span class="o">=</span> <span class="n">input_embeddings</span><span class="p">[:</span><span class="o">-</span><span class="n">num_new_tokens</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="c1">#   output_embeddings_avg = output_embeddings[:-num_new_tokens].mean(dim=0, keepdim=True)</span>

        <span class="n">input_embeddings</span><span class="p">[</span><span class="o">-</span><span class="n">num_new_tokens</span><span class="p">:]</span> <span class="o">=</span> <span class="n">input_embeddings_avg</span>

    <span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pad_token_id</span> <span class="o">=</span> <span class="n">llama_tokenizer</span><span class="o">.</span><span class="n">pad_token_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.potential"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.models.potential.PotentialModel" class="doc doc-heading">
            <code>PotentialModel</code>


<a href="#mattext.models.potential.PotentialModel" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mattext.models.utils.TokenizerMixin">TokenizerMixin</span></code></p>


        <p>Class to perform finetuning of a language model on
the hypothetical potential task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for the fine-tuning.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_rank</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local rank for distributed training. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/mattext/models/potential.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PotentialModel</span><span class="p">(</span><span class="n">TokenizerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to perform finetuning of a language model on</span>
<span class="sd">    the hypothetical potential task.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg (DictConfig): Configuration for the fine-tuning.</span>
<span class="sd">        local_rank (int, optional): Local rank for distributed training. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">local_rank</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span><span class="p">,</span>
            <span class="n">special_tokens</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">special_tokens</span><span class="p">,</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">special_num_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="o">=</span> <span class="n">local_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_data</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">test_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">finetune</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">context_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_datasets</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetune_traindata</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_testset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_datasets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_data</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">split</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare training and validation datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_df (pd.DataFrame): DataFrame containing training data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetDict: Dictionary containing training and validation datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
        <span class="c1"># with contextlib.suppress(KeyError):</span>
        <span class="c1">#     ds = ds.remove_columns(&quot;labels&quot;)</span>
        <span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;test set&quot;</span><span class="p">)</span>

        <span class="n">labal_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;total_energy_alpha_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="n">labal_name</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="c1"># dataset= dataset.filter(lambda example: example[self.representation] is not None)</span>
        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_pad_and_truncate</span><span class="p">,</span> <span class="n">context_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context_length</span>
            <span class="p">),</span>
            <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainerCallback</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of callbacks for early stopping, and custom logging.&quot;&quot;&quot;</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EarlyStoppingCallback</span><span class="p">(</span>
                    <span class="n">early_stopping_patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_patience</span><span class="p">,</span>
                    <span class="n">early_stopping_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_threshold</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">custom_logger</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomWandbCallback_FineTune</span><span class="p">())</span>

        <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EvaluateFirstStepCallback</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">callbacks</span>

    <span class="k">def</span> <span class="nf">_compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">predictions</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="p">)</span>  <span class="c1"># Convert predictions to PyTorch tensor</span>
        <span class="n">label_ids</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">label_ids</span><span class="p">)</span>  <span class="c1"># Convert label_ids to PyTorch tensor</span>

        <span class="k">if</span> <span class="nb">eval</span><span class="p">:</span>
            <span class="c1"># Calculate RMSE as evaluation metric</span>
            <span class="n">eval_rmse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">label_ids</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">eval_rmse</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate RMSE as training metric</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">preds</span> <span class="o">-</span> <span class="n">label_ids</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;train_rmse&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="mi">3</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform fine-tuning of the language model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pretrained_ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pretrained_checkpoint</span>

        <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

        <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
            <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
            <span class="n">metric_for_best_model</span><span class="o">=</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">,</span>  <span class="c1"># Metric to use for determining the best model</span>
            <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Lower eval_rmse is better</span>
        <span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="n">pretrained_ckpt</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_mismatched_sizes</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">freeze_base_model</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
                <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
            <span class="n">data_collator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">compute_metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">,</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_tokenizer</span><span class="p">,</span>
            <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
            <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)})</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>

        <span class="n">eval_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_testset</span><span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eval_result</span><span class="p">)</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the fine-tuned model on the test dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.models.potential.PotentialModel.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">()</span></code>

<a href="#mattext.models.potential.PotentialModel.evaluate" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluate the fine-tuned model on the test dataset.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/potential.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the fine-tuned model on the test dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">finetune</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mattext.models.potential.PotentialModel.finetune" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finetune</span><span class="p">()</span></code>

<a href="#mattext.models.potential.PotentialModel.finetune" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Perform fine-tuning of the language model.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/potential.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">finetune</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform fine-tuning of the language model.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pretrained_ckpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pretrained_checkpoint</span>

    <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
    <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span>
        <span class="o">**</span><span class="n">config_train_args</span><span class="p">,</span>
        <span class="n">metric_for_best_model</span><span class="o">=</span><span class="s2">&quot;eval_rmse&quot;</span><span class="p">,</span>  <span class="c1"># Metric to use for determining the best model</span>
        <span class="n">greater_is_better</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Lower eval_rmse is better</span>
    <span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="n">pretrained_ckpt</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_mismatched_sizes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">freeze_base_model</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">parameters</span><span class="p">():</span>
            <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
        <span class="n">data_collator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">compute_metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">,</span>
        <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_tokenizer</span><span class="p">,</span>
        <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
        <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)})</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>

    <span class="n">eval_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_testset</span><span class="p">)</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eval_result</span><span class="p">)</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.predict"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="mattext.models.pretrain"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="mattext.models.pretrain.PretrainModel" class="doc doc-heading">
            <code>PretrainModel</code>


<a href="#mattext.models.pretrain.PretrainModel" class="headerlink" title="Permanent link">🔗</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="mattext.models.utils.TokenizerMixin">TokenizerMixin</span></code></p>


        <p>Class to perform pretraining of a language model.</p>






              <details class="quote">
                <summary>Source code in <code>src/mattext/models/pretrain.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PretrainModel</span><span class="p">(</span><span class="n">TokenizerMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to perform pretraining of a language model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">,</span> <span class="n">local_rank</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span><span class="p">,</span>
            <span class="n">special_tokens</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">special_tokens</span><span class="p">,</span>
            <span class="n">special_num_token</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">special_num_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="o">=</span> <span class="n">local_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">representation</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">representation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_repository</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data_repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pretrain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">context_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">callbacks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_name_or_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_file_path</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dataset_local_path</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dataset_local_path</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_train_datasets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenized_eval_datasets</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_datasets</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span><span class="n">local_file_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">local_file_path</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare training and validation datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            train_df (pd.DataFrame): DataFrame containing training data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetDict: Dictionary containing training and validation datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">local_file_path</span><span class="p">:</span>
            <span class="c1"># Load data from a local JSON file</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">/train.json&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
            <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">/test.json&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Load data from the repository</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_repository</span><span class="p">,</span> <span class="n">subset</span><span class="p">)</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
            <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>

        <span class="n">filtered_train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">example</span><span class="p">:</span> <span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">filtered_eval_dataset</span> <span class="o">=</span> <span class="n">eval_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">example</span><span class="p">:</span> <span class="n">example</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">representation</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">filtered_train_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_pad_and_truncate</span><span class="p">,</span> <span class="n">context_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context_length</span>
            <span class="p">),</span>
            <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span> <span class="n">filtered_eval_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tokenize_pad_and_truncate</span><span class="p">,</span> <span class="n">context_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context_length</span>
            <span class="p">),</span>
            <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainerCallback</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of callbacks for early stopping, and custom logging.&quot;&quot;&quot;</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">EarlyStoppingCallback</span><span class="p">(</span>
                    <span class="n">early_stopping_patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_patience</span><span class="p">,</span>
                    <span class="n">early_stopping_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">early_stopping_threshold</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">custom_logger</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CustomWandbCallback_Pretrain</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">callbacks</span>

    <span class="k">def</span> <span class="nf">pretrain_mlm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs MLM pretraining of the language model.&quot;&quot;&quot;</span>
        <span class="n">config_mlm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mlm</span>
        <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
        <span class="n">config_model_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_config</span>
        <span class="c1">#config_model_args[&quot;max_position_embeddings&quot;] = self.context_length</span>

        <span class="n">data_collator</span> <span class="o">=</span> <span class="n">DataCollatorForLanguageModeling</span><span class="p">(</span>
            <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_tokenizer</span><span class="p">,</span>
            <span class="n">mlm</span><span class="o">=</span><span class="n">config_mlm</span><span class="o">.</span><span class="n">is_mlm</span><span class="p">,</span>
            <span class="n">mlm_probability</span><span class="o">=</span><span class="n">config_mlm</span><span class="o">.</span><span class="n">mlm_probability</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">AutoConfig</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">,</span> <span class="o">**</span><span class="n">config_model_args</span>
        <span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForMaskedLM</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

        <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span><span class="o">**</span><span class="n">config_train_args</span><span class="p">)</span>

        <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">data_collator</span><span class="o">=</span><span class="n">data_collator</span><span class="p">,</span>
            <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_train_datasets</span><span class="p">,</span>
            <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_eval_datasets</span><span class="p">,</span>
            <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;config_details&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">)})</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
        <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)})</span>

        <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="c1"># Save the fine-tuned model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="mattext.models.pretrain.PretrainModel.pretrain_mlm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pretrain_mlm</span><span class="p">()</span></code>

<a href="#mattext.models.pretrain.PretrainModel.pretrain_mlm" class="headerlink" title="Permanent link">🔗</a></h3>


    <div class="doc doc-contents ">

        <p>Performs MLM pretraining of the language model.</p>

            <details class="quote">
              <summary>Source code in <code>src/mattext/models/pretrain.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pretrain_mlm</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs MLM pretraining of the language model.&quot;&quot;&quot;</span>
    <span class="n">config_mlm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">mlm</span>
    <span class="n">config_train_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">training_arguments</span>
    <span class="n">config_model_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">model_config</span>
    <span class="c1">#config_model_args[&quot;max_position_embeddings&quot;] = self.context_length</span>

    <span class="n">data_collator</span> <span class="o">=</span> <span class="n">DataCollatorForLanguageModeling</span><span class="p">(</span>
        <span class="n">tokenizer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped_tokenizer</span><span class="p">,</span>
        <span class="n">mlm</span><span class="o">=</span><span class="n">config_mlm</span><span class="o">.</span><span class="n">is_mlm</span><span class="p">,</span>
        <span class="n">mlm_probability</span><span class="o">=</span><span class="n">config_mlm</span><span class="o">.</span><span class="n">mlm_probability</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">callbacks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks</span><span class="p">()</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">AutoConfig</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name_or_path</span><span class="p">,</span> <span class="o">**</span><span class="n">config_model_args</span>
    <span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForMaskedLM</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">local_rank</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span><span class="p">)</span>

    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span><span class="o">**</span><span class="n">config_train_args</span><span class="p">)</span>

    <span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">data_collator</span><span class="o">=</span><span class="n">data_collator</span><span class="p">,</span>
        <span class="n">train_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_train_datasets</span><span class="p">,</span>
        <span class="n">eval_dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tokenized_eval_datasets</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="n">training_args</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;config_details&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config</span><span class="p">)})</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Training Arguments&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">config_train_args</span><span class="p">)})</span>
    <span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;model_summary&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)})</span>

    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="c1"># Save the fine-tuned model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">finetuned_modelname</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><!-- ## Dataprep


::: mattext.dataprep
    heading_level: 3 -->












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      LAMAlab
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/lamalab-org/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/jablonkagroup" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tabs.link", "content.code.annotation", "content.code.copy", "content.code.copy_button", "navigation.tabs", "navigation.sections", "navigation.top", "toc.integrate", "search.suggest", "search.highlight", "search.share", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>